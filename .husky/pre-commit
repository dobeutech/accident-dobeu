#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Run linting
echo "ğŸ“ Checking code style..."
cd backend && npm run lint --silent || {
    echo "âŒ Linting failed. Please fix errors before committing."
    exit 1
}

# Run tests
echo "ğŸ§ª Running tests..."
npm run test --silent || {
    echo "âŒ Tests failed. Please fix failing tests before committing."
    exit 1
}

# Check for secrets
echo "ğŸ” Checking for secrets..."
if git diff --cached --name-only | xargs grep -i "password\|secret\|api_key\|token" | grep -v ".example" | grep -v "README" | grep -v "docs/"; then
    echo "âš ï¸  Warning: Possible secrets detected in staged files"
    echo "Please review and ensure no sensitive data is being committed"
fi

echo "âœ… Pre-commit checks passed!"
